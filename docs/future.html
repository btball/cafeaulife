<!DOCTYPE html>  <html> <head>   <title>future.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="cache.html">                 cache.coffee               </a>                                           <a class="source" href="cafeaulife.html">                 cafeaulife.coffee               </a>                                           <a class="source" href="future.html">                 future.coffee               </a>                                           <a class="source" href="rules.html">                 rules.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               future.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This module is part of <a href="http:cafeaulife.html">cafeaulife.coffee</a>.</p>

<h2>Future Module</h2>

<p>The Future Module provides methods for computing the future of a pattern, taking into account its ability to grow beyond
the size of its container square.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>The Life "Universe"</h3>

<p>The <code>result</code> given for class <code>Square</code> is handy, but not directly useful for computing the future of a pattern,
because it computes the future of the <em>center</em> of a square, not the future of a square. Of course, the future of
a square depends very much on what surrounds it, and there is an algorithm for computing the future of a surface
tiled with squares.</p>

<p>However, there is a special case that interests us, the futrue of a square that sits within an otherwise empty
Life "Universe." When we build a Life pattern and run it into the future, we are specifically considering the
case where a sqaure is surrounded by empty squares and may grow beyond the boundaries of the initial square.</p>

<p>This module mixes special case functionality for computing the <code>future</code> of a square into <code>Square</code> and <code>Cell</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Baseline Setup</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Cafe au Life uses <a href="http://documentcloud.github.com/underscore/">Underscore.js</a> extensively:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>YouAreDaChef provides a nice clean set of semantics for AOP</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">YouAreDaChef = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;YouAreDaChef&#39;</span><span class="p">).</span><span class="nx">YouAreDaChef</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>Mix the functionality into <code>Square</code> and <code>Cell</code></h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.mixInto = </span><span class="nf">({Square, Cell}) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The <code>result</code> given for squares is handy, but not directly useful for computing the future of a pattern,
because it computes the future of the <em>center</em> of a square, not the future of a square. If we imagine
a square sitting in the middle of an infinite, empty Life universe, the future of the pattern within
the square is going to be larger than the square, it will expand one cell in each direction for every
generation into the future.</p>

<p>For example, if we start with:</p>

<pre><code>nw  ne
  ??
  ??
sw  sw
</code></pre>

<p>After <code>2^0</code> generations we double its size:</p>

<pre><code>nw    ne
  ????
  ????
  ????
  ????
sw    se
</code></pre>

<p>After <code>2^1</code> more generations we double again:</p>

<pre><code>nw        ne
  ????????
  ????????
  ????????
  ????????
  ????????
  ????????
  ????????
  ????????
sw        se
</code></pre>

<p>After <code>2^2</code> additional generations on top of that we double yet again:</p>

<pre><code>nw                ne
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
sw                se
</code></pre>

<p>And so it goes. The relationship becomes clear if we stop thinking about generations and sizes and
start thinking about the binary logarithm of generations and sizes. For historical reasons, the binary
logarithm of the length of a side of a square is called its <strong>level</strong>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>2x2 squares are level 1. 4x4 squares are level 2. In other words, the level of a square is the level of
its component quadrants plus one. This sets up a recursion which amounts to counting the squares in a
path from our subject square to its component cells.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">YouAreDaChef</span><span class="p">(</span><span class="nx">Square</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">after</span> <span class="s1">&#39;initialize&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="vi">@level = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">level</span> <span class="o">+</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Cells are level zero, which terminates the recursion.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">level:</span>
      <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>In a moment we'll give the method for doubling the size of a square and moving it forward into the future,
very much in the style of obtaining a cell's <code>result</code>, and not suprisingly using results to compute its future.
But first, let's determine how far forward in time doubling a square moves it.</p>

<p>A square of size two moves one generation forward. A square of size four moves two generations forward. A
square of size eight moves four generations forward. More simply:</p>

<p><strong>A square of level <code>L</code> moves 2^(L-1) generations forward in time and doubles in size</strong>.</p>

<p>This is exactly the same relationship a square has to its <code>result</code>: The result of a square is 2^(L-1)
generations forward in time.</p>

<p>Results and futures are inverses of each other. The result of a square is a smaller square forward in time that
we can know regardless of what lies outside of the square. The future of a square is a larger square forward
in time that we can know given that only empty space lies outside the square.</p>

<p>The difference is that a result square has a level of <code>L-1</code> and a future has a level of <code>L+1</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>Calculating the immediate future</h3>

<p>Let's start with a diagram for determining the future of a square:</p>

<p>Given (the <code>?</code> stands for a cell or square):</p>

<pre><code>nw  ne
  ??
  ??
sw  se
</code></pre>

<p>We want:</p>

<pre><code>nw    ne
  ????
  ????
  ????
  ????
sw    se
</code></pre>

<p>Borrowing from our technique for computing results, we want to find some squares with results we can stitch together
to make our future square. So let's build our future square. Consider these four squares. In each one, we have duplicated
our square in one of its corners and filled the remainder with empty squares the same size as our square:</p>

<pre><code>nw         ne
  ....|....
  ....|....
  ..??|??..
  ..??|??..
  ----+----
  ..??|??..
  ..??|??..
  ....|....
  ....|....
sw         se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>We're redy to use this diagram to write our method. First, here's our code for making empty squares:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nv">empty_quadrant = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">empty_copy</span><span class="p">()</span>
      <span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
        <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
        <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
        <span class="nv">se: </span><span class="nx">empty_quadrant</span>
        <span class="nv">sw: </span><span class="nx">empty_quadrant</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nx">Cell</span><span class="p">.</span><span class="nx">Dead</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Here's our method:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">future: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>an empty copy of our square</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">vacant = </span><span class="nx">@empty_copy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Let's make the four squares diagrammed above</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">four_squares =</span>
        <span class="nv">nw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">vacant</span>
            <span class="nv">ne: </span><span class="nx">vacant</span>
            <span class="nv">se: </span><span class="k">this</span>
            <span class="nv">sw: </span><span class="nx">vacant</span>
        <span class="nv">ne: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">vacant</span>
            <span class="nv">ne: </span><span class="nx">vacant</span>
            <span class="nv">se: </span><span class="nx">vacant</span>
            <span class="nv">sw: </span><span class="k">this</span>
        <span class="nv">se: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="k">this</span>
            <span class="nv">ne: </span><span class="nx">vacant</span>
            <span class="nv">se: </span><span class="nx">vacant</span>
            <span class="nv">sw: </span><span class="nx">vacant</span>
        <span class="nv">sw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">vacant</span>
            <span class="nv">ne: </span><span class="k">this</span>
            <span class="nv">se: </span><span class="nx">vacant</span>
            <span class="nv">sw: </span><span class="nx">vacant</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Let's take their results:</p>

<pre><code>nw         ne
  ....|....
  .++.|.++.
  .++.|.++.
  ....|....
  ----+----
  ....|....
  .++.|.++.
  .++.|.++.
  ....|....
sw         se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">four_results =</span>
        <span class="nv">nw: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">ne: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">se: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">sw: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Consider those results relative to the original square.
let's redraw the diagram, but this time we'll have everything overlap.</p>

<p>Here're the four squares again in two diagrams:</p>

<pre><code>nw      ne  nw      ne
  ....          ....
  ....          ....
  ..??..      ..??..
  ..??..      ..??..
    ....      ....
    ....      ....
sw      se  sw      se
</code></pre>

<p>Now we draw the results of those four:</p>

<pre><code>nw      ne  nw      ne
  ....          ....
  .nw.          .ne.
  .nw...      ...ne.
  ...se.      .sw...
    .se.      .sw.
    ....      ....
sw      se  sw      se
</code></pre>

<p>And superimpose those results:</p>

<pre><code>nw    ne
  nwne
  nwne
  swse
  swse
sw    se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Presto! Our four results are the future square we're after!</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
        <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span><span class="p">(</span><span class="nx">four_results</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3>Import and export</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><code>to_json</code> and <code>toString</code> are simple methods for cells.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">to_json: </span><span class="o">-&gt;</span>
      <span class="p">[</span><span class="nx">@value</span><span class="p">]</span>
    <span class="nv">toString: </span><span class="o">-&gt;</span>
      <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">@value</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><code>to_json</code> and <code>toString</code> are memoized methods for squares</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">YouAreDaChef</span><span class="p">(</span><span class="nx">Square</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">after</span> <span class="s1">&#39;initialize&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="vi">@to_json = </span><span class="nx">_</span><span class="p">.</span><span class="nx">memoize</span><span class="p">(</span> <span class="o">-&gt;</span>
        <span class="nv">a =</span>
          <span class="nv">nw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">to_json</span><span class="p">()</span>
          <span class="nv">ne: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">to_json</span><span class="p">()</span>
          <span class="nv">se: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">to_json</span><span class="p">()</span>
          <span class="nv">sw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">to_json</span><span class="p">()</span>
        <span class="nv">b =</span>
          <span class="nv">top: </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">zip</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">nw</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">ne</span><span class="p">),</span> <span class="nf">([left, right]) -&gt;</span>
            <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span>
              <span class="nx">left</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">right</span><span class="p">)</span>
            <span class="k">else</span>
              <span class="p">[</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">]</span>
          <span class="p">)</span>
          <span class="nv">bottom: </span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">_</span><span class="p">.</span><span class="nx">zip</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">sw</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">se</span><span class="p">),</span> <span class="nf">([left, right]) -&gt;</span>
            <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">left</span><span class="p">)</span>
              <span class="nx">left</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">right</span><span class="p">)</span>
            <span class="k">else</span>
              <span class="p">[</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="p">]</span>
          <span class="p">)</span>
        <span class="nx">b</span><span class="p">.</span><span class="nx">top</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">bottom</span><span class="p">)</span>
      <span class="p">)</span>
      <span class="vi">@toString = </span><span class="nx">_</span><span class="p">.</span><span class="nx">memoize</span><span class="p">(</span> <span class="o">-&gt;</span>
        <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span> <span class="nx">@to_json</span><span class="p">(),</span> <span class="nf">(row) -&gt;</span>
          <span class="p">([</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">][</span><span class="nx">c</span><span class="p">]</span> <span class="k">for</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">row</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>Making copies of squares</h3>

<p>For calculating the future of a square containing a pattern, we often need to make a larger square with the
current square centered surrounded by empty squares. We also need to trim such a square to a smaller size,
discarding the borders.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>A core requirement is to make an empty copy of a cell or square. In effect, we are making an empty
square of the same size.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nx">Cell</span><span class="p">.</span><span class="nx">Dead</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>We don't bother memoizing this method for squares, we are already taking advantage of redundancy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nv">empty_quadrant = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">empty_copy</span><span class="p">()</span>
      <span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
        <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
        <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
        <span class="nv">se: </span><span class="nx">empty_quadrant</span>
        <span class="nv">sw: </span><span class="nx">empty_quadrant</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Given the ability to make an empty copy, we can now resize squares to any size. We start with methods to inflte and deflate
squares, and implement resizing a square with them.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Find or create a smaller square centered on this square</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">crop_by: </span><span class="nf">(extant) -&gt;</span>
      <span class="k">return</span> <span class="k">this</span> <span class="k">if</span> <span class="nx">extant</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span><span class="p">(</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span> <span class="p">[</span><span class="mi">0</span><span class="p">..(</span><span class="nx">extant</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span> <span class="nf">(quadrants) -&gt;</span>
          <span class="nv">nw: </span><span class="nx">quadrants</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">quadrants</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">quadrants</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">quadrants</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span>
        <span class="p">,</span> <span class="k">this</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Find or create a larger square centered on this square with
the excess composed of empty squares</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">pad_by: </span><span class="nf">(extant) -&gt;</span>
      <span class="k">if</span> <span class="nx">extant</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="k">this</span>
      <span class="k">else</span>
        <span class="nv">empty_quadrant = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">empty_copy</span><span class="p">()</span>
        <span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
              <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
              <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
              <span class="nv">se: </span><span class="nx">@nw</span>
              <span class="nv">sw: </span><span class="nx">empty_quadrant</span>
            <span class="nv">ne: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
              <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
              <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
              <span class="nv">se: </span><span class="nx">empty_quadrant</span>
              <span class="nv">sw: </span><span class="nx">@ne</span>
            <span class="nv">se: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
              <span class="nv">nw: </span><span class="nx">@se</span>
              <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
              <span class="nv">se: </span><span class="nx">empty_quadrant</span>
              <span class="nv">sw: </span><span class="nx">empty_quadrant</span>
            <span class="nv">sw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
              <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
              <span class="nv">ne: </span><span class="nx">@sw</span>
              <span class="nv">se: </span><span class="nx">empty_quadrant</span>
              <span class="nv">sw: </span><span class="nx">empty_quadrant</span>
          <span class="p">.</span><span class="nx">pad_by</span><span class="p">(</span><span class="nx">extant</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Resize to a given level</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">resize_to: </span><span class="nf">(level) -&gt;</span>
      <span class="nv">this_level = </span><span class="nx">@level</span>
      <span class="k">if</span> <span class="nx">level</span> <span class="o">&gt;</span> <span class="nx">this_level</span>
        <span class="nx">@pad_by</span><span class="p">(</span><span class="nx">level</span> <span class="o">-</span> <span class="nx">this_level</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">level</span> <span class="o">&lt;</span> <span class="nx">this_level</span>
        <span class="nx">@crop_by</span><span class="p">(</span><span class="nx">this_level</span> <span class="o">-</span> <span class="nx">level</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="k">this</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 