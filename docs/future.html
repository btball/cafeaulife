<!DOCTYPE html>  <html> <head>   <title>future.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="api.html">                 api.coffee               </a>                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="cache.html">                 cache.coffee               </a>                                           <a class="source" href="cafeaulife.html">                 cafeaulife.coffee               </a>                                           <a class="source" href="future.html">                 future.coffee               </a>                                           <a class="source" href="rules.html">                 rules.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               future.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This module is part of <a href="http:cafeaulife.html">cafeaulife.coffee</a>.</p>

<h2>Future Module</h2>

<p>The Future Module provides methods for computing the future of a pattern, taking into account its ability to grow beyond
the size of its container square.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>The Life "Universe"</h3>

<p>The <code>result</code> given for class <code>Square</code> is handy, but not directly useful for computing the future of a pattern,
because it computes the future of the <em>center</em> of a square, not the future of a square. Of course, the future of
a square depends very much on what surrounds it, and there is an algorithm for computing the future of a surface
tiled with squares.</p>

<p>However, there is a special case that interests us, the futrue of a square that sits within an otherwise empty
Life "Universe." When we build a Life pattern and run it into the future, we are specifically considering the
case where a sqaure is surrounded by empty squares and may grow beyond the boundaries of the initial square.</p>

<p>This module mixes special case functionality for computing the <code>future</code> of a square into <code>Square</code> and <code>Cell</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Baseline Setup</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Cafe au Life uses <a href="http://documentcloud.github.com/underscore/">Underscore.js</a> extensively:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>YouAreDaChef provides a nice clean set of semantics for AOP</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">YouAreDaChef = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;YouAreDaChef&#39;</span><span class="p">).</span><span class="nx">YouAreDaChef</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Play with Node and some browsers</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span> <span class="o">?=</span> <span class="nb">window</span> <span class="o">or</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>Mix the functionality into <code>Square</code> and <code>Cell</code></h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exports.mixInto = </span><span class="nf">({Square, Cell}) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The <code>result</code> given for squares is handy, but not directly useful for computing the future of a pattern,
because it computes the future of the <em>center</em> of a square, not the future of a square. If we imagine
a square sitting in the middle of an infinite, empty Life universe, the future of the pattern within
the square is going to be larger than the square, it will expand one cell in each direction for every
generation into the future.</p>

<p>For example, if we start with:</p>

<pre><code>nw  ne
  ??
  ??
sw  sw
</code></pre>

<p>After <code>2^0</code> generations we double its size:</p>

<pre><code>nw    ne
  ????
  ????
  ????
  ????
sw    se
</code></pre>

<p>After <code>2^1</code> more generations we double again:</p>

<pre><code>nw        ne
  ????????
  ????????
  ????????
  ????????
  ????????
  ????????
  ????????
  ????????
sw        se
</code></pre>

<p>After <code>2^2</code> additional generations on top of that we double yet again:</p>

<pre><code>nw                ne
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
  ????????????????
sw                se
</code></pre>

<p>And so it goes. The relationship becomes clear if we stop thinking about generations and sizes and
start thinking about the binary logarithm of generations and sizes. For historical reasons, the binary
logarithm of the length of a side of a square is called its <strong>level</strong>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>2x2 squares are level 1. 4x4 squares are level 2. In other words, the level of a square is the level of
its component quadrants plus one. This sets up a recursion which amounts to counting the squares in a
path from our subject square to its component cells.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">YouAreDaChef</span><span class="p">(</span><span class="nx">Square</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">after</span> <span class="s1">&#39;initialize&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="vi">@level = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">level</span> <span class="o">+</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Cells are level zero, which terminates the recursion.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">level:</span>
      <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>In a moment we'll give the method for doubling the size of a square and moving it forward into the future,
very much in the style of obtaining a cell's <code>result</code>, and not suprisingly using results to compute its future.
But first, let's determine how far forward in time doubling a square moves it.</p>

<p>A square of size two moves one generation forward. A square of size four moves two generations forward. A
square of size eight moves four generations forward. More simply:</p>

<p><strong>A square of level <code>L</code> moves 2^(L-1) generations forward in time and doubles in size</strong>.</p>

<p>This is exactly the same relationship a square has to its <code>result</code>: The result of a square is 2^(L-1)
generations forward in time.</p>

<p>Results and futures are inverses of each other. The result of a square is a smaller square forward in time that
we can know regardless of what lies outside of the square. The future of a square is a larger square forward
in time that we can know given that only empty space lies outside the square.</p>

<p>The difference is that a result square has a level of <code>L-1</code> and a future has a level of <code>L+1</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Calculating the immediate future</h3>

<p>Let's start with a diagram for determining the future of a square:</p>

<p>Given (the <code>?</code> stands for a cell or square):</p>

<pre><code>nw  ne
  ??
  ??
sw  se
</code></pre>

<p>We want:</p>

<pre><code>nw    ne
  ????
  ????
  ????
  ????
sw    se
</code></pre>

<p>Borrowing from our technique for computing results, we want to find some squares with results we can stitch together
to make our future square. So let's build our future square. Consider these four squares. In each one, we have duplicated
our square in one of its corners and filled the remainder with empty squares the same size as our square:</p>

<pre><code>nw         ne
  ....|....
  ....|....
  ..??|??..
  ..??|??..
  ----+----
  ..??|??..
  ..??|??..
  ....|....
  ....|....
sw         se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>We're ready to use this diagram to write a function for computing the future of a square. First, here're methods for making empty squares:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nv">empty_quadrant = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">empty_copy</span><span class="p">()</span>
      <span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
        <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
        <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
        <span class="nv">se: </span><span class="nx">empty_quadrant</span>
        <span class="nv">sw: </span><span class="nx">empty_quadrant</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nx">Cell</span><span class="p">.</span><span class="nx">Dead</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Now a function. It takes a square and calculates its future 2^(L-1) generations forward in time and
at level L+1:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">future = </span><span class="nf">(square) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>an empty copy of our square</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">vacant = </span><span class="nx">square</span><span class="p">.</span><span class="nx">empty_copy</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Let's make the four squares diagrammed above</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">four_squares =</span>
      <span class="nv">nw: </span><span class="nx">Square</span>
        <span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">vacant</span>
          <span class="nv">ne: </span><span class="nx">vacant</span>
          <span class="nv">se: </span><span class="nx">square</span>
          <span class="nv">sw: </span><span class="nx">vacant</span>
      <span class="nv">ne: </span><span class="nx">Square</span>
        <span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">vacant</span>
          <span class="nv">ne: </span><span class="nx">vacant</span>
          <span class="nv">se: </span><span class="nx">vacant</span>
          <span class="nv">sw: </span><span class="nx">square</span>
      <span class="nv">se: </span><span class="nx">Square</span>
        <span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">square</span>
          <span class="nv">ne: </span><span class="nx">vacant</span>
          <span class="nv">se: </span><span class="nx">vacant</span>
          <span class="nv">sw: </span><span class="nx">vacant</span>
      <span class="nv">sw: </span><span class="nx">Square</span>
        <span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">vacant</span>
          <span class="nv">ne: </span><span class="nx">square</span>
          <span class="nv">se: </span><span class="nx">vacant</span>
          <span class="nv">sw: </span><span class="nx">vacant</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Let's take their results:</p>

<pre><code>nw         ne
  ....|....
  .++.|.++.
  .++.|.++.
  ....|....
  ----+----
  ....|....
  .++.|.++.
  .++.|.++.
  ....|....
sw         se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">four_results =</span>
      <span class="nv">nw: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
      <span class="nv">ne: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
      <span class="nv">se: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
      <span class="nv">sw: </span><span class="nx">four_squares</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Consider those results relative to the original square.
let's redraw the diagram, but this time we'll have everything overlap.</p>

<p>Here're the four squares again in two diagrams:</p>

<pre><code>nw      ne  nw      ne
  ....          ....
  ....          ....
  ..??..      ..??..
  ..??..      ..??..
    ....      ....
    ....      ....
sw      se  sw      se
</code></pre>

<p>Now we draw the results of those four:</p>

<pre><code>nw      ne  nw      ne
  ....          ....
  .nw.          .ne.
  .nw...      ...ne.
  ...se.      .sw...
    .se.      .sw.
    ....      ....
sw      se  sw      se
</code></pre>

<p>And superimpose those results:</p>

<pre><code>nw    ne
  nwne
  nwne
  swse
  swse
sw    se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Presto! Our four results are the future square we're after!</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span><span class="p">(</span><span class="nx">four_results</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Given the function that computes a square's future, we can apply
our function repeatedly to the future of our pattern. Given some
number <code>T</code> where <code>T &gt;= L</code>, by applying <code>future(...)</code> <code>(T-L)</code> times,
we move <code>2^(T+1) - 2^(L-1)</code> generations:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">future: </span><span class="nf">(t = @level)-&gt;</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span> <span class="p">[</span><span class="err">@</span><span class="p">.</span><span class="nx">level</span><span class="p">..</span><span class="nx">t</span><span class="p">],</span> <span class="nx">future</span><span class="p">,</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <hr />

<p><strong>(c) 2012 <a href="http://reginald.braythwayt.com">Reg Braithwaite</a></strong> (<a href="http://twitter.com/raganwald">@raganwald</a>)</p>

<p>Cafe au Life is freely distributable under the terms of the <a href="http://en.wikipedia.org/wiki/MIT_License">MIT license</a>.</p>

<p>The annotated source code was generated directly from the <a href="https://github.com/raganwald/cafeaulife/blob/master/lib">original source</a> using <a href="http://jashkenas.github.com/docco/">Docco</a>.</p>

<p>Recent work:</p>

<ul>
<li><a href="http://leanpub.com/combinators">Kestrels, Quirky Birds, and Hopeless Egocentricity</a>, all of my writing about combinators, collected into one e-book.</li>
<li><a href="http://leanpub.com/shippingsoftware">What I've Learned From Failure</a>, my very best essays about getting software from ideas to shipping products, collected into one e-book.</li>
<li><a href="http://github.com/raganwald/Katy">Katy</a>, a library for writing fluent CoffeeScript and JavaScript using combinators.</li>
<li><a href="http://github.com/raganwald/YouAreDaChef">YouAreDaChef</a>, a library for writing method combinations for CoffeeScript and JavaScript projects.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 