<!DOCTYPE html>  <html> <head>   <title>future.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="api.html">                 api.coffee               </a>                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="cache.html">                 cache.coffee               </a>                                           <a class="source" href="cafeaulife.html">                 cafeaulife.coffee               </a>                                           <a class="source" href="future.html">                 future.coffee               </a>                                           <a class="source" href="rules.html">                 rules.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               future.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This module is part of <a href="http:cafeaulife.html">cafeaulife.coffee</a>.</p>

<h2>Future Module</h2>

<p>The Future Module provides methods for computing the future of a pattern, taking into account its ability to grow beyond
the size of its container square.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>The Life "Universe"</h3>

<p>The <code>result</code> given for class <code>Square</code> is handy, but not directly useful for computing the future of a pattern,
because it computes the future of the <em>center</em> of a square, not the future of a square. Of course, the future of
a square depends very much on what surrounds it, and there is an algorithm for computing the future of a surface
tiled with squares.</p>

<p>However, there is a special case that interests us, the future of a square that sits within an otherwise empty
Life "Universe." When we build a Life pattern and run it into the future, we are specifically considering the
case where a square is surrounded by empty squares and may grow beyond the boundaries of the initial square.</p>

<p>This module mixes special case functionality for computing the <code>future</code> of a square into <code>Square</code> and <code>Cell</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Baseline Setup</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">)</span>
<span class="nv">YouAreDaChef = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;YouAreDaChef&#39;</span><span class="p">).</span><span class="nx">YouAreDaChef</span>
<span class="nx">exports</span> <span class="o">?=</span> <span class="nb">window</span> <span class="o">or</span> <span class="k">this</span>


<span class="nv">exports.mixInto = </span><span class="nf">({Square, Cell}) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Computing a result for a time less than <code>T+2^(n-1)</code></h3>

<p>What if we don't want to move so far forward in time? Well, we don't have to. First, let's revist our
intermediate square. Here's another way to make an intermediate square from a square, we crop an existing
square to its size. This produces an intermediate square at time T+0 relative to the square:</p>

<pre><code>nw        ne
  ........
  .nwnnne.
  .nwnnne.
  .wwccee.
  .wwccee.
  .swssse.
  .swssse.
  ........
sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">YouAreDaChef</span><span class="p">(</span><span class="nx">Square</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">after</span> <span class="s1">&#39;initialize&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="vi">@level = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">level</span> <span class="o">+</span> <span class="mi">1</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">level:</span>
      <span class="mi">0</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">intermediate_via_crop: </span><span class="o">-&gt;</span>
      <span class="k">new</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">Intermediate</span>
        <span class="nv">nw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">nn: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">ne: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">se: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">ww: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">cc: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">ee: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">sw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">ss: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">sw</span>
          <span class="nv">se: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">ne</span>
        <span class="nv">se: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">ne: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">se</span>
          <span class="nv">se: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
          <span class="nv">sw: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Armed with this one additional function, we can write a general method for determining the result
of a square at an arbitrary point forward in time. Modulo some error checking, we check and see whether
we are moving forward more or less than half as much as the maimum amount. If it's more than half, we
start by generating the intermediate square from results. If it's less than half, we start by generating
the intermediate squre by cropping.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">result_at_time_zero: </span><span class="o">-&gt;</span>
      <span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
        <span class="nv">nw: </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">se</span>
        <span class="nv">ne: </span><span class="nx">@ne</span><span class="p">.</span><span class="nx">sw</span>
        <span class="nv">se: </span><span class="nx">@se</span><span class="p">.</span><span class="nx">nw</span>
        <span class="nv">sw: </span><span class="nx">@sw</span><span class="p">.</span><span class="nx">ne</span>
    <span class="nv">result_at_time: </span><span class="nf">(t) -&gt;</span>
      <span class="k">if</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="k">throw</span> <span class="s2">&quot;We do not have a time machine&quot;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">t</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">@result_at_time_zero</span><span class="p">()</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">t</span> <span class="o">&lt;=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">@level</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nv">sub_squares = </span><span class="nx">@intermediate_via_crop</span><span class="p">().</span><span class="nx">sub_squares</span><span class="p">()</span>
        <span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
          <span class="nv">ne: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
          <span class="nv">se: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
          <span class="nv">sw: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">@level</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">@level</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nv">sub_squares = </span><span class="nx">@intermediate_via_subresults</span><span class="p">().</span><span class="nx">sub_squares</span><span class="p">()</span>
        <span class="nv">t_remaining = </span><span class="nx">t</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">@level</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t_remaining</span><span class="p">)</span>
          <span class="nv">ne: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t_remaining</span><span class="p">)</span>
          <span class="nv">se: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t_remaining</span><span class="p">)</span>
          <span class="nv">sw: </span><span class="nx">sub_squares</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t_remaining</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">t</span> <span class="o">is</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">@level</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nx">@result</span><span class="p">()</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">t</span> <span class="o">&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">@level</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;I can&#39;t go further forward than #{Math.pow(2, @level - 2)}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>Computing the future of a square</h3>

<p>Let's say we have a square and we wish to determine its future at time <code>t</code>.
We calculate the smallest square that could possible contain its future, taking
into account that the pattern in the square could grow once cell in each direction
per generation.</p>

<p>We then double the size and embed our pattern in the center. This becomes our base
square: It's our square embdedded in a possible vast empty square. We then take the
base square's <code>result_at_time(t)</code> which gives us the future of our pattern.</p>

<p>We start with the ability to make empty copies of things.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Cell</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nx">Cell</span><span class="p">.</span><span class="nx">Dead</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Square</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
    <span class="nv">empty_copy: </span><span class="o">-&gt;</span>
      <span class="nv">empty_quadrant = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">empty_copy</span><span class="p">()</span>
      <span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
        <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
        <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
        <span class="nv">se: </span><span class="nx">empty_quadrant</span>
        <span class="nv">sw: </span><span class="nx">empty_quadrant</span>

    <span class="nv">pad_by: </span><span class="nf">(extant) -&gt;</span>
      <span class="k">if</span> <span class="nx">extant</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="k">this</span>
      <span class="k">else</span>
        <span class="nv">empty_quadrant = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">empty_copy</span><span class="p">()</span>
        <span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
          <span class="nv">nw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
            <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
            <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
            <span class="nv">se: </span><span class="nx">@nw</span>
            <span class="nv">sw: </span><span class="nx">empty_quadrant</span>
          <span class="nv">ne: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
            <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
            <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
            <span class="nv">se: </span><span class="nx">empty_quadrant</span>
            <span class="nv">sw: </span><span class="nx">@ne</span>
          <span class="nv">se: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
            <span class="nv">nw: </span><span class="nx">@se</span>
            <span class="nv">ne: </span><span class="nx">empty_quadrant</span>
            <span class="nv">se: </span><span class="nx">empty_quadrant</span>
            <span class="nv">sw: </span><span class="nx">empty_quadrant</span>
          <span class="nv">sw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">canonicalize</span>
            <span class="nv">nw: </span><span class="nx">empty_quadrant</span>
            <span class="nv">ne: </span><span class="nx">@sw</span>
            <span class="nv">se: </span><span class="nx">empty_quadrant</span>
            <span class="nv">sw: </span><span class="nx">empty_quadrant</span>
        <span class="p">.</span><span class="nx">pad_by</span><span class="p">(</span><span class="nx">extant</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nv">future_at_time: </span><span class="nf">(t) -&gt;</span>
      <span class="k">if</span> <span class="nx">t</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="k">throw</span> <span class="s2">&quot;We do not have a time machine&quot;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">t</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="k">this</span>
      <span class="k">else</span>
        <span class="nv">base = </span><span class="nx">@pad_by</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="nx">base</span><span class="p">.</span><span class="nx">result_at_time</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <hr />

<p><strong>(c) 2012 <a href="http://reginald.braythwayt.com">Reg Braithwaite</a></strong> (<a href="http://twitter.com/raganwald">@raganwald</a>)</p>

<p>Cafe au Life is freely distributable under the terms of the <a href="http://en.wikipedia.org/wiki/MIT_License">MIT license</a>.</p>

<p>The annotated source code was generated directly from the <a href="https://github.com/raganwald/cafeaulife/blob/master/lib">original source</a> using <a href="http://jashkenas.github.com/docco/">Docco</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 