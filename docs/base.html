<!DOCTYPE html>  <html> <head>   <title>base.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.coffee               </a>                                           <a class="source" href="cache.html">                 cache.coffee               </a>                                           <a class="source" href="cafeaulife.html">                 cafeaulife.coffee               </a>                                           <a class="source" href="future.html">                 future.coffee               </a>                                           <a class="source" href="rules.html">                 rules.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               base.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This module is part of <a href="http:cafeaulife.html">cafeaulife.coffee</a>.</p>

<h2>Base Module</h2>

<p>The Base Module provides the <code>Cell</code> and <code>Square</code> classes, including <code>RecursivelyComputableSquare</code>, the foundation of the
HashLife implementation.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Baseline Setup</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Cafe au Life uses <a href="http://documentcloud.github.com/underscore/">Underscore.js</a> extensively:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_ = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Play with Node and some browsers</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span> <span class="o">?=</span> <span class="nb">window</span> <span class="o">or</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>Cells</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The smallest unit of Life is the Cell:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Cell</span>
  <span class="nv">constructor: </span><span class="nf">(@value) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>A simple point-cut that allows us to apply advice to contructors.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>By default, do nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">-&gt;</span>
  <span class="nv">to_json: </span><span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">@value</span><span class="p">]</span>
  <span class="nv">toValue: </span><span class="o">-&gt;</span>
    <span class="nx">@value</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Export <code>Cell</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span> <span class="nx">exports</span><span class="p">,</span> <span class="p">{</span><span class="nx">Cell</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Squares</h3>

<p><img src="block_laying_seed.png" alt="Block laying seed" title="" /></p>

<p><em>(A small pattern that creates a block-laying switch engine, a "puffer train" that grows forever.)</em></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>HashLife operates on square regions of the board, with the length of the side of each square being a natural power of two
(<code>2^1 -&gt; 2</code>, <code>2^2 -&gt; 4</code>, <code>2^3 -&gt; 8</code>...). Cells are not considered squares. Therefore, the smallest possible square
(of size <code>2^1</code>) has cells for each of its four quadrants, while all larger squares (of size <code>2^n</code>) have squares of one smaller
size (<code>2^(n-1)</code>) for each of their four quadrants.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>For example, a square of size eight (<code>2^3</code>) is composed of four squares of size four (<code>2^2</code>):</p>

<pre><code>nw         ne
  ....|....
  ....|....
  ....|....
  ....|....
  ————#————
  ....|....
  ....|....
  ....|....
  ....|....
sw         se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>The squares of size four are in turn each composed of four squares of size two (<code>2^1</code>):</p>

<pre><code>nw           ne
  ..|..|..|..
  ..|..|..|..
  ——+——|——+——
  ..|..|..|..
  ..|..|..|..
  —————#—————
  ..|..|..|..
  ..|..|..|..
  ——+——|——+——
  ..|..|..|..
  ..|..|..|..
sw           se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>And those in turn are each composed of four cells, which cannot be subdivided. (For simplicity, a Cafe au Life
board is represented as one such large square, although the HashLife
algorithm can be used to handle any board shape by tiling it with squares.)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>The key principle behind HashLife is taking advantage of redundancy. Therefore, two squares with the same alive and dead cells
are always represented by the same, immutable square objects. HashLife exploits repetition and redundancy by making all squares
idempotent and unique. In other words, if two squares contain the same sequence of cells, they are represented by the same
instance of class <code>Square</code>. For example, there is exactly one representation of a square of size two containing four empty cells:</p>

<pre><code>nw  ne
  ..
  ..
sw  sw
</code></pre>

<p>And thus, a square of size four containing sixteen empty cells is represented as four references to the exact same square of
size two containing four empty cells:</p>

<pre><code>nw     ne
  ..|..
  ..|..
  --+--
  ..|..
  ..|..
sw     se
</code></pre>

<p>And likewise a square of size eight containing sixty-four empty cells is represented as four references to the exact same
square of size four containing sixteen empty cells.</p>

<pre><code>nw         ne
  ....|....
  ....|....
  ....|....
  ....|....
  ----+----
  ....|....
  ....|....
  ....|....
  ....|....
sw         se
</code></pre>

<p>Obviously, the same goes for any configuration of alive and dead cells: There is one unique representation for any possible
square and each of its four quadrants is a reference to a unique representation of a smaller square or cell.</p>

<h3>Representing squares</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>HashLife represents each unique square as a structure with four quadrants:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Square</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Squares are constructed from four quadrant squares or cells and store a hash used
to locate the square in the cache</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">({@nw, @ne, @se, @sw}) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>A simple point-cut that allows us to apply advice to contructors.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>By default, do nothing</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Export <code>Square</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span> <span class="nx">exports</span><span class="p">,</span> <span class="p">{</span><span class="nx">Square</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>The Speed of Light</h3>

<p>In Life, the "Speed of Light" or "<em>c</em>" is one cell vertically, horizontally, or diagonally in any direction. Meaning,
that cause and effect cannot travel faster than <em>c</em>.</p>

<p>One consequence of this fundamental limit is that given a square of size <code>2^n | n &gt; 1</code> at time <code>t</code>, HashLife has all
the information it needs to calculate the alive and dead cells for the inner square of size <code>2^n - 2</code> at time <code>t+1</code>.
For example, if HashLife has this square at time <code>t</code>:</p>

<pre><code>nw        ne
  ....|....
  ....|....
  ....|....
  ....|....
  ----+----
  ....|....
  ....|....
  ....|....
  ....|....
sw        se
</code></pre>

<p>HashLife can calculate this square at time <code>t+1</code>:</p>

<pre><code>nw         ne

   ...|...
   ...|...
   ...|...
   ---+---
   ...|...
   ...|...
   ...|...

sw         se
</code></pre>

<p>And this square at time <code>t+2</code>:</p>

<pre><code>nw         ne


    ..|..
    ..|..
    --+--
    ..|..
    ..|..


sw         se
</code></pre>

<p>And this square at time <code>t+3</code>:</p>

<pre><code>nw        ne



     ..
     ..



sw        se
</code></pre>

<p>This is because no matter what is in the cells surrounding our square, their effects cannot propagate
faster than the speed of light, one row inward from the edge every step in time.</p>

<p>HashLife takes advantage of this by storing enough information to quickly look up the shrinking
'future' for every square of size <code>2^n | n &gt; 1</code>. The information is called a square's <em>result</em>.</p>

<h2>Computing the result for squares</h2>

<p><img src="block_laying_seed_2.png" alt="Block laying seed" title="" /></p>

<p><em>(Another small pattern that creates a block-laying switch engine, a "puffer train" that grows forever.)</em></p>

<p>Let's revisit the obvious: Cells do not have results. Also, Squares ofsize two do not have results,
because at time <code>t+1</code>, cells outside of the square will affect every cell in the square.</p>

<p>The smallest square that computes a result is of size four (<code>2^2</code>). Its result is a square of
size two (<code>2^1</code>) representing the state of those cells at time <code>t+1</code>:</p>

<pre><code>....
.++.
.++.
....
</code></pre>

<p>The computation of the four inner <code>+</code> cells from their adjacent eight cells is straightforward and
is calculated from the basic 2-3 rules or looked up from a table with 65K entries.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Recursively constructing squares of size eight (and larger)</h2>

<p><img src="LWSS.gif" alt="Lightweight Spaceship" title="" /></p>

<p><em>(A small pattern that moves.)</em></p>

<p>Now let's consider a square of size eight. For the moment, we can ignore the question of what happens
when a square is not in the cache, because when dealing with squares of size eight, we only ever need
to look up squares of size four, and they are all seeded in the cache. (Once we have established how
to construct the result for a square of size eight, including its result and velocity, we will be able
to write out <code>.find</code> method to handle looking up squares of size eight and dealing with cache 'misses'
by constructing a new square.)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Our class will be a <code>RecursivelyComputableSquare</code>. We'll isolate helpers:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">RecursivelyComputableSquare = </span><span class="nx">do</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>We know how to obtain any square of size four using <code>cache.find</code>. So what we need is a way to compute
the result for any arbitrary square of size eight or larger from quadrant squares one level smaller.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Our goal is to compute a result that looks like this (the lines and crosses are part of the result):</p>

<pre><code>nw        ne

    +--+
    |..|
    |..|
    +--+

sw        se
</code></pre>

<p>Given that we know the result for each of those four squares, we can start building an intermediate result.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>The class for intermediate results:</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">class</span> <span class="nx">IntermediateResult</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>We construct an intermediate result from a square of size eight or larger</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">constructor: </span><span class="nf">(square) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>For convenience, we'll use Underscore's <code>extend</code> rather than a lot of assignments
to @nw, @se, et cetera.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="k">this</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>First, Let's look at our square of size eight made up of four component squares of size four (the lines
and crosses are part of the components):</p>

<pre><code>nw        ne
  +--++--+
  |..||..|
  |..||..|
  +--++--+
  +--++--+
  |..||..|
  |..||..|
  +--++--+
sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>We can take the results of those four quadrants and add them to our intermediate square</p>

<pre><code>nw        ne

   nw..ne
   nw..ne
   ......
   ......
   sw..se
   sw..se

sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">nw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">ne: </span><span class="nx">square</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">se: </span><span class="nx">square</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">sw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>We can also derive four overlapping squares, these representing <code>n</code>, <code>e</code>, <code>s</code>, and <code>w</code>:</p>

<pre><code>     nn
  ..+--+..        ..+--+..
  ..|..|..        ..|..|..
  +-|..|-+        +--++--+
  |.+--+.|      w |..||..| e
  |.+--+.|      w |..||..| e
  +-|..|-+        +--++--+
  ..|..|..        ..|..|..
  ..+--+..        ..+--+..
     ss
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Deriving these from our four component squares is straightforward, and when we take their results,
we fill in four of the five missing blanks for our intermediate square:</p>

<pre><code>nw        ne

   ..nn..
   ..nn..
   ww..ee
   ww..ee
   ..ss..
   ..ss..

sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">nn: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">ne</span>
            <span class="nv">ne: </span><span class="nx">square</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">nw</span>
            <span class="nv">se: </span><span class="nx">square</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">sw</span>
            <span class="nv">sw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
          <span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">ee: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">sw</span>
            <span class="nv">ne: </span><span class="nx">square</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">se</span>
            <span class="nv">se: </span><span class="nx">square</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">ne</span>
            <span class="nv">sw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
          <span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">ss: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span>
            <span class="nv">ne: </span><span class="nx">square</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
            <span class="nv">se: </span><span class="nx">square</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">sw</span>
            <span class="nv">sw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">se</span>
          <span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">ww: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">sw</span>
            <span class="nv">ne: </span><span class="nx">square</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
            <span class="nv">se: </span><span class="nx">square</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span>
            <span class="nv">sw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">nw</span>
          <span class="p">.</span><span class="nx">result</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>We use a similar method to derive a center square:</p>

<pre><code>nw        ne

   ......
   .+--+.
   .|..|.
   .|..|.
   .+--+.
   ......

sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>And we extract its result square accordingly:</p>

<pre><code>nw        ne

   ......
   ......
   ..cc..
   ..cc..
   ......
   ......

sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">cc: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">se</span>
            <span class="nv">ne: </span><span class="nx">square</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">sw</span>
            <span class="nv">se: </span><span class="nx">square</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">nw</span>
            <span class="nv">sw: </span><span class="nx">square</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">ne</span>
          <span class="p">.</span><span class="nx">result</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>We have now derived nine squares of size <code>2^(n-1)</code>: Four component squares and five we have
derived from second-order components. The results we have extracted have all been cached, so
we are performing lookups rather than computations.</p>

<p>These squares fit together to make a larger intermediate square, one that does not neatly fit
into our world of <code>2^n</code> quanta:</p>

<pre><code>nw        ne

   nwnnne
   nwnnne
   wwccee
   wwccee
   swssse
   swssse

sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <h3>Obtaining a result from the intermediate square</h3>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">result: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>From our nine squares, we can make four <em>overlapping</em> squares of size <code>2^(n-1)</code>:</p>

<pre><code>nw        ne  nw        ne

   nwnn..        ..nnne
   nwnn..        ..nnne
   wwcc..        ..ccee
   wwcc..        ..ccee
   ......        ......
   ......        ......

sw        se  sw        se

nw        ne  nw        ne

   ......        ......
   ......        ......
   wwcc..        ..ccee
   wwcc..        ..ccee
   swss..        ..ssse
   swss..        ..ssse

sw        se  sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">overlapping_squares =</span>
        <span class="nv">nw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">@nw</span>
            <span class="nv">ne: </span><span class="nx">@nn</span>
            <span class="nv">se: </span><span class="nx">@cc</span>
            <span class="nv">sw: </span><span class="nx">@ww</span>
        <span class="nv">ne: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">@nn</span>
            <span class="nv">ne: </span><span class="nx">@ne</span>
            <span class="nv">se: </span><span class="nx">@ee</span>
            <span class="nv">sw: </span><span class="nx">@cc</span>
        <span class="nv">se: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">@cc</span>
            <span class="nv">ne: </span><span class="nx">@ee</span>
            <span class="nv">se: </span><span class="nx">@se</span>
            <span class="nv">sw: </span><span class="nx">@ss</span>
        <span class="nv">sw: </span><span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span>
          <span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
            <span class="nv">nw: </span><span class="nx">@ww</span>
            <span class="nv">ne: </span><span class="nx">@cc</span>
            <span class="nv">se: </span><span class="nx">@ss</span>
            <span class="nv">sw: </span><span class="nx">@sw</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>We can now make a square from the results from each of those quadrants:</p>

<pre><code>nw        ne

   ......
   .nwne.
   .nwne.
   .swse.
   .swse.
   ......

sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">Square</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">canonicalize_by_quadrant</span>
        <span class="nv">nw: </span><span class="nx">overlapping_squares</span><span class="p">.</span><span class="nx">nw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">ne: </span><span class="nx">overlapping_squares</span><span class="p">.</span><span class="nx">ne</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">se: </span><span class="nx">overlapping_squares</span><span class="p">.</span><span class="nx">se</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span>
        <span class="nv">sw: </span><span class="nx">overlapping_squares</span><span class="p">.</span><span class="nx">sw</span><span class="p">.</span><span class="nx">result</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>A <code>RecursivelyComputableSquare</code> is a square of size eight or larger</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">class</span> <span class="nx">RecursivelyComputableSquare</span> <span class="k">extends</span> <span class="nx">Square</span>
    <span class="nv">constructor: </span><span class="nf">(quadrants) -&gt;</span>
      <span class="k">super</span><span class="p">(</span><span class="nx">quadrants</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>When we fit the results of an intermediate square within our original square
of size eight, we reveal we have a square of size four, <code>2^(n-1)</code> as we wanted</p>

<pre><code>nw        ne
  ........
  ........
  ..nwne..
  ..nwne..
  ..swse..
  ..swse..
  ........
  ........
sw        se
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@result = </span><span class="nx">_</span><span class="p">.</span><span class="nx">memoize</span><span class="p">(</span> <span class="o">-&gt;</span>
        <span class="k">new</span> <span class="nx">IntermediateResult</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">result</span><span class="p">()</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>The number of generation is double the number of generations of any of its quadrants.
This can also be derived mathematically from the level: <code>math.pow(2, @level - 1)</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="vi">@generations = </span><span class="nx">@nw</span><span class="p">.</span><span class="nx">generations</span> <span class="o">*</span> <span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Export <code>RecursivelyComputableSquare</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">_</span><span class="p">.</span><span class="nx">defaults</span> <span class="nx">exports</span><span class="p">,</span> <span class="p">{</span><span class="nx">RecursivelyComputableSquare</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>p.s. This document was generated from <a href="https://github.com/raganwald/cafeaulife/blob/master/lib/cafeaulife.coffee">cafeaulife.coffee</a> using <a href="http://jashkenas.github.com/docco/">Docco</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 